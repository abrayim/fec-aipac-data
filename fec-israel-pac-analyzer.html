<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FEC Israel PAC Analyzer</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/papaparse@5/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef } = React;

        // Israel-related PAC data from TrackAIPAC.com
        const ISRAEL_PACS = {
            'C00797670': 'American Israel Public Affairs Committee Political Action Committee',
            'C00492579': 'American Principles',
            'C00687657': 'American Pro-Israel PAC',
            'C00138701': 'Americans for Good Government',
            'C00113019': 'Americans United in Support of Democracy / Citizens Concerned for the National Interest',
            'C00155713': 'BAYPAC',
            'C00381624': 'Because I Care PAC',
            'C00204388': 'Bi-County PAC',
            'C00110585': 'Citizens Organized Political Action Committee',
            'C00187526': 'City PAC',
            'C00152579': 'Delaware Valley PAC',
            'C00429571': 'California Jewish Democrats-FED / Democrats for Israel Committee',
            'C00710848': 'DMFI PAC (Democratic Majority for Israel)',
            'C00265470': 'Friends of Israel',
            'C00141747': 'Friends of Israel Political Action Committee / San Franciscans for Good Government',
            'C00169136': 'Garden State PAC',
            'C00473249': 'Grand Canyon State Caucus',
            'C00131557': 'Heartland PAC',
            'C00158865': 'Hudson Valley PAC',
            'C00557926': 'I-PAC JAX',
            'C00815753': 'J Street Action Fund',
            'C00139659': 'Joint Action Committee for Political Affairs',
            'C00441949': 'JStreetPAC',
            'C00144170': 'Louisianians for American Security Political Action Committee',
            'C00195024': 'Maryland Association for Concerned Citizens Political Action Committee',
            'C00165944': 'Mid Manhattan PAC',
            'C00199950': 'MOPAC',
            'C00189696': 'Multi-Issue PAC',
            'C00147983': 'National Action Committee',
            'C00150995': 'National PAC',
            'C00247403': 'NorPAC / North Jersey PAC',
            'C00302414': 'Northwest PAC',
            'C00232611': 'PAC of Cherry Hill New Jersey',
            'C00878801': 'Preserve America PAC (Miriam Adelson)',
            'C00756882': 'Preserve America PAC (Sheldon Adelson)',
            'C00740936': 'Pro-Israel America Action Fund',
            'C00699470': 'Pro-Israel America PAC',
            'C90012063': 'Republican Jewish Coalition',
            'C00345132': 'Republican Jewish Coalition-Political Action Committee (RJC-PAC)',
            'C00148155': 'St. Louisans for Better Government',
            'C00378216': 'SunPAC',
            'C00102368': 'The Desert Caucus',
            'C00135541': 'To Protect Our Heritage PAC',
            'C00799031': 'United Democracy Project (UDP)',
            'C00152280': 'United PAC (Illinois)',
            'C00127811': 'US Israel PAC / Florida Congressional Committee',
            'C00138560': 'Washington PAC',
            'C00203182': "Women's Pro-Israel National PAC",
            'C00236596': 'World Alliance for Israel PAC / Women\'s Alliance for Israel',
            'C00305607': 'Young Jewish Leadership PAC',
            'C00891259': 'Zioness PAC',
            'C00548628': 'Zionist Organization of America'
        };

        function FECAnalyzer() {
            const [results, setResults] = useState(null);
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(false);
            const fileInputRef = useRef(null);

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setLoading(true);
                setError(null);
                setResults(null);

                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        try {
                            analyzeData(results.data);
                        } catch (err) {
                            setError(`Error analyzing file: ${err.message}`);
                            setLoading(false);
                        }
                    },
                    error: (error) => {
                        setError(`Error parsing CSV: ${error.message}`);
                        setLoading(false);
                    }
                });
            };

            const analyzeData = (data) => {
                const matches = [];
                let totalAmount = 0;

                data.forEach(row => {
                    const pacId = row.unused_contbr_id?.trim();
                    const entityType = row.entity_type?.trim();
                    
                    // Only include if entity_type is PAC and ID matches our Israel PAC list
                    if (entityType === 'PAC' && pacId && ISRAEL_PACS[pacId]) {
                        const amount = parseFloat(row.contribution_receipt_amount) || 0;
                        totalAmount += amount;
                        
                        matches.push({
                            pacId: pacId,
                            pacName: ISRAEL_PACS[pacId],
                            contributorName: row.contributor_name || 'Unknown',
                            amount: amount,
                            date: row.contribution_receipt_date || 'Unknown',
                            candidateName: row.candidate_name || 'N/A'
                        });
                    }
                });

                // Sort by date (most recent first)
                matches.sort((a, b) => {
                    if (a.date === 'Unknown') return 1;
                    if (b.date === 'Unknown') return -1;
                    return new Date(b.date) - new Date(a.date);
                });

                // Collect all years across all contributions
                const allYears = new Set();
                matches.forEach(match => {
                    if (match.date && match.date !== 'Unknown') {
                        try {
                            const year = new Date(match.date).getFullYear();
                            if (!isNaN(year)) {
                                allYears.add(year);
                            }
                        } catch (e) {
                            // Skip invalid dates
                        }
                    }
                });
                const sortedYears = Array.from(allYears).sort();

                // Group by PAC
                const groupedByPac = {};
                matches.forEach(match => {
                    if (!groupedByPac[match.pacId]) {
                        groupedByPac[match.pacId] = {
                            pacName: match.pacName,
                            contributions: [],
                            total: 0,
                            byYear: {}
                        };
                        // Initialize all years to 0
                        sortedYears.forEach(year => {
                            groupedByPac[match.pacId].byYear[year] = 0;
                        });
                    }
                    groupedByPac[match.pacId].contributions.push(match);
                    groupedByPac[match.pacId].total += match.amount;
                    
                    // Add to year total
                    if (match.date && match.date !== 'Unknown') {
                        try {
                            const year = new Date(match.date).getFullYear();
                            if (!isNaN(year)) {
                                groupedByPac[match.pacId].byYear[year] += match.amount;
                            }
                        } catch (e) {
                            // Skip invalid dates
                        }
                    }
                });

                setResults({
                    totalMatches: matches.length,
                    totalAmount: totalAmount,
                    matches: matches,
                    groupedByPac: groupedByPac,
                    years: sortedYears
                });
                setLoading(false);
            };

            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2
                }).format(amount);
            };

            const formatDate = (dateStr) => {
                if (dateStr === 'Unknown' || !dateStr) return 'Unknown';
                try {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                } catch {
                    return dateStr;
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 py-8 px-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-8 mb-6">
                            <h1 className="text-3xl font-bold text-gray-900 mb-2">
                                FEC Israel-Related PAC Analyzer
                            </h1>
                            <p className="text-gray-600 mb-6">
                                Upload your FEC.gov CSV export to analyze contributions from Israel-related PACs
                            </p>

                            <div className="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center bg-gray-50 hover:bg-gray-100 transition-colors">
                                <input
                                    ref={fileInputRef}
                                    type="file"
                                    accept=".csv"
                                    onChange={handleFileUpload}
                                    className="hidden"
                                />
                                <button
                                    onClick={() => fileInputRef.current.click()}
                                    className="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors"
                                >
                                    {loading ? 'Analyzing...' : 'Upload FEC CSV File'}
                                </button>
                                <p className="text-sm text-gray-500 mt-3">
                                    Supports CSV exports from FEC.gov
                                </p>
                            </div>

                            {error && (
                                <div className="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                                    <p className="text-red-800 font-medium">Error:</p>
                                    <p className="text-red-600 text-sm">{error}</p>
                                </div>
                            )}
                        </div>

                        {results && (
                            <div className="space-y-6">
                                {/* Summary Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h3 className="text-sm font-medium text-gray-500 uppercase tracking-wide">
                                            Total Contributions
                                        </h3>
                                        <p className="text-3xl font-bold text-gray-900 mt-2">
                                            {results.totalMatches}
                                        </p>
                                    </div>
                                    <div className="bg-white rounded-lg shadow p-6">
                                        <h3 className="text-sm font-medium text-gray-500 uppercase tracking-wide">
                                            Total Amount
                                        </h3>
                                        <p className="text-3xl font-bold text-green-600 mt-2">
                                            {formatCurrency(results.totalAmount)}
                                        </p>
                                    </div>
                                </div>

                                {/* High-Level PAC Summary */}
                                <div className="bg-white rounded-lg shadow overflow-hidden">
                                    <div className="px-6 py-4 bg-gray-50 border-b border-gray-200">
                                        <h2 className="text-xl font-bold text-gray-900">
                                            Summary by PAC
                                        </h2>
                                    </div>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-50">
                                                        PAC Name
                                                    </th>
                                                    {results.years.map(year => (
                                                        <th key={year} className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            {year}
                                                        </th>
                                                    ))}
                                                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-100">
                                                        Total
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {Object.entries(results.groupedByPac)
                                                    .sort((a, b) => b[1].total - a[1].total)
                                                    .map(([pacId, data]) => (
                                                    <tr key={pacId} className="hover:bg-gray-50">
                                                        <td className="px-6 py-4 sticky left-0 bg-white">
                                                            <div className="text-sm font-medium text-gray-900">
                                                                {data.pacName}
                                                            </div>
                                                            <div className="text-xs text-gray-500 font-mono mt-1">
                                                                {pacId}
                                                            </div>
                                                        </td>
                                                        {results.years.map(year => (
                                                            <td key={year} className="px-4 py-4 text-right text-sm text-gray-700 whitespace-nowrap">
                                                                {data.byYear[year] > 0 ? formatCurrency(data.byYear[year]) : '-'}
                                                            </td>
                                                        ))}
                                                        <td className="px-6 py-4 text-right text-sm font-bold text-green-600 bg-gray-50 whitespace-nowrap">
                                                            {formatCurrency(data.total)}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                            <tfoot className="bg-gray-100 border-t-2 border-gray-300">
                                                <tr>
                                                    <td className="px-6 py-4 sticky left-0 bg-gray-100">
                                                        <div className="text-sm font-bold text-gray-900">
                                                            TOTAL ALL PACS
                                                        </div>
                                                    </td>
                                                    {results.years.map(year => {
                                                        const yearTotal = Object.values(results.groupedByPac)
                                                            .reduce((sum, pac) => sum + (pac.byYear[year] || 0), 0);
                                                        return (
                                                            <td key={year} className="px-4 py-4 text-right text-sm font-bold text-gray-900 whitespace-nowrap">
                                                                {formatCurrency(yearTotal)}
                                                            </td>
                                                        );
                                                    })}
                                                    <td className="px-6 py-4 text-right text-sm font-bold text-green-700 bg-gray-100 whitespace-nowrap">
                                                        {formatCurrency(results.totalAmount)}
                                                    </td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>

                                {/* Grouped by PAC - Detailed */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h2 className="text-xl font-bold text-gray-900 mb-4">
                                        Detailed Breakdown by PAC
                                    </h2>
                                    <p className="text-sm text-gray-600 mb-4">
                                        Individual transactions for each PAC
                                    </p>
                                    <div className="space-y-4">
                                        {Object.entries(results.groupedByPac)
                                            .sort((a, b) => b[1].total - a[1].total)
                                            .map(([pacId, data]) => (
                                            <div key={pacId} className="border border-gray-200 rounded-lg p-4">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div className="flex-1">
                                                        <h3 className="font-semibold text-gray-900">
                                                            {data.pacName}
                                                        </h3>
                                                        <p className="text-xs text-gray-500 font-mono">
                                                            {pacId}
                                                        </p>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="font-bold text-green-600">
                                                            {formatCurrency(data.total)}
                                                        </p>
                                                        <p className="text-xs text-gray-500">
                                                            {data.contributions.length} contribution{data.contributions.length !== 1 ? 's' : ''}
                                                        </p>
                                                    </div>
                                                </div>

                                                {/* Individual contributions for this PAC */}
                                                <div className="mt-3 space-y-2">
                                                    {data.contributions.map((contrib, idx) => (
                                                        <div key={idx} className="bg-gray-50 p-3 rounded text-sm">
                                                            <div className="flex justify-between items-start">
                                                                <div className="flex-1">
                                                                    <p className="text-gray-700">
                                                                        <span className="font-medium">Date:</span> {formatDate(contrib.date)}
                                                                    </p>
                                                                    {contrib.candidateName !== 'N/A' && (
                                                                        <p className="text-gray-600 text-xs mt-1">
                                                                            Candidate: {contrib.candidateName}
                                                                        </p>
                                                                    )}
                                                                </div>
                                                                <p className="font-semibold text-green-600">
                                                                    {formatCurrency(contrib.amount)}
                                                                </p>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* All Transactions (chronological) */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h2 className="text-xl font-bold text-gray-900 mb-4">
                                        All Transactions (Chronological)
                                    </h2>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        Date
                                                    </th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        PAC Name
                                                    </th>
                                                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        Candidate
                                                    </th>
                                                    <th className="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                        Amount
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {results.matches.map((match, idx) => (
                                                    <tr key={idx} className="hover:bg-gray-50">
                                                        <td className="px-4 py-3 text-sm text-gray-900 whitespace-nowrap">
                                                            {formatDate(match.date)}
                                                        </td>
                                                        <td className="px-4 py-3 text-sm text-gray-900">
                                                            <div>
                                                                <div className="font-medium">{match.pacName}</div>
                                                                <div className="text-xs text-gray-500 font-mono">{match.pacId}</div>
                                                            </div>
                                                        </td>
                                                        <td className="px-4 py-3 text-sm text-gray-600">
                                                            {match.candidateName}
                                                        </td>
                                                        <td className="px-4 py-3 text-sm font-semibold text-green-600 text-right whitespace-nowrap">
                                                            {formatCurrency(match.amount)}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Data Source Attribution */}
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <p className="text-sm text-blue-800">
                                        <strong>Data Sources:</strong> Israel-related PAC list from{' '}
                                        <a 
                                            href="https://trackaipac.com" 
                                            target="_blank" 
                                            rel="noopener noreferrer"
                                            className="underline hover:text-blue-900"
                                        >
                                            TrackAIPAC.com
                                        </a>
                                        . FEC contribution data from user-uploaded CSV export.
                                    </p>
                                </div>
                            </div>
                        )}

                        {/* Instructions */}
                        <div className="mt-8 bg-white rounded-lg shadow p-6">
                            <h2 className="text-lg font-bold text-gray-900 mb-3">
                                How to Use
                            </h2>
                            <ol className="list-decimal list-inside space-y-2 text-gray-700">
                                <li>Go to <a href="https://www.fec.gov" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">FEC.gov</a></li>
                                <li>Search for your candidate/committee and export contribution data as CSV</li>
                                <li>Upload the CSV file using the button above</li>
                                <li>View matched contributions from Israel-related PACs</li>
                            </ol>
                            <p className="mt-4 text-sm text-gray-600">
                                The analyzer matches the <code className="bg-gray-100 px-1 rounded">unused_contbr_id</code> field 
                                in your FEC CSV against {Object.keys(ISRAEL_PACS).length} known Israel-related PAC IDs.
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<FECAnalyzer />, document.getElementById('root'));
    </script>
</body>
</html>
